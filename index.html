<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cat√°logo de Filmes</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<h1>Cat√°logo de Filmes</h1>

<form id="cadastro-filme">
    <h2>Buscar Novo Filme</h2>
    <div>
        <label for="titulo">T√≠tulo do Filme:</label>
        <input type="text" id="titulo" required placeholder="Ex: Vingadores, Titanic, etc.">
    </div>

    <button type="submit">Buscar Filme</button>
</form>
<hr>

<h2>Minha Lista de Filmes</h2>

<div id="lista-filmes">
    <p>Nenhum filme cadastrado ainda.</p>
</div>

<script>
// üîë Sua chave da API OMDb
const API_KEY = 'c4e45fd4'; 
let catalogo = JSON.parse(localStorage.getItem('catalogo')) || [];

// 2. Captura de elementos do DOM
const form = document.getElementById('cadastro-filme');
const tituloInput = document.getElementById('titulo');
const listaFilmesContainer = document.getElementById('lista-filmes');

// ------------------------------------------------
// Fun√ß√£o de remo√ß√£o
// ------------------------------------------------
function removerFilme(indice, elementoDOM) {
    catalogo.splice(indice, 1);
    elementoDOM.remove();

    // Atualiza a mensagem se n√£o houver filmes
    if (catalogo.length === 0) {
        listaFilmesContainer.innerHTML = '<p>Nenhum filme cadastrado ainda.</p>';
    }
}

// ------------------------------------------------
// Fun√ß√£o de renderiza√ß√£o de filme
// ------------------------------------------------
function renderizarFilme(filme) {
    if (catalogo.length === 1) {
        listaFilmesContainer.innerHTML = '';
    }

    const filmeDiv = document.createElement('div');
    filmeDiv.classList.add('filme-item');

    // Poster
    const imagemPoster = document.createElement('img');
    imagemPoster.src = filme.poster && filme.poster !== 'N/A' ? filme.poster : '';
    imagemPoster.alt = `Poster do Filme ${filme.titulo}`;
    imagemPoster.classList.add('filme-poster');

    // Informa√ß√µes
    const infoDiv = document.createElement('div');
    infoDiv.classList.add('filme-info');

    const tituloH3 = document.createElement('h3');
    tituloH3.textContent = filme.titulo;

    const sinopseP = document.createElement('p');
    sinopseP.textContent = filme.sinopse;

    const removerBotao = document.createElement('button');
    removerBotao.textContent = 'Remover';
    removerBotao.classList.add('btn-remover');

    removerBotao.addEventListener('click', () => {
        const indiceAtual = catalogo.findIndex(f => f.titulo === filme.titulo);
        if (indiceAtual > -1) {
            removerFilme(indiceAtual, filmeDiv);
        }
    });

    // Montagem
    infoDiv.appendChild(tituloH3);
    infoDiv.appendChild(sinopseP);
    infoDiv.appendChild(removerBotao);

    filmeDiv.appendChild(imagemPoster);
    filmeDiv.appendChild(infoDiv);

    listaFilmesContainer.appendChild(filmeDiv);
}

// ------------------------------------------------
// Fun√ß√£o principal (busca na API)
// ------------------------------------------------
async function adicionarFilme(evento) {
    evento.preventDefault();

    const titulo = tituloInput.value.trim();
    if (!titulo) return;

    const tituloFormatado = encodeURIComponent(titulo);
    const url = `https://www.omdbapi.com/?apikey=${API_KEY}&t=${tituloFormatado}`;

    try {
        const resposta = await fetch(url);
        const dadosDoFilme = await resposta.json();

        if (dadosDoFilme.Response === "True") {
            const novoFilme = {
                titulo: dadosDoFilme.Title,
                sinopse: dadosDoFilme.Plot,
                poster: dadosDoFilme.Poster,
            };

            catalogo.push(novoFilme);
            renderizarFilme(novoFilme);
        } else {
            alert(`Filme n√£o encontrado na OMDb: "${titulo}".`);
        }

    } catch (error) {
        alert('Erro ao buscar filme na API. Verifique sua conex√£o ou chave.');
        console.error('Erro de Fetch:', error);
    }

    form.reset();
}

// 6. Escuta o evento de envio
form.addEventListener('submit', adicionarFilme);

console.log("Cat√°logo de filmes iniciado com busca por API ativa.");
</script>

</body>
</html>
