<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo de Filmes</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<h1>Catálogo de Filmes</h1>

<form id="cadastro-filme">
    <h2>Buscar Novo Filme</h2>
    <div>
        <label for="titulo">Título do Filme:</label>
        <input type="text" id="titulo" required>
    </div>
    <div>
        <label for="sinopse">Sinopse:</label>
        <textarea id="sinopse" required></textarea>
    </div>

    <button type="submit">Buscar Filme</button>
</form>
<hr>

<h2>Minha Lista De Filmes</h2>

<div id="lista-filmes">
    <p>Nenhum filme cadastrado ainda.</p>
</div>

<script>
// A CHAVE SECRETA DA API OMDb (Substitua esta string pela sua chave real!)
const API_KEY = 'c4e45fd4'; 

// 1. ARMAZENAMENTO DE DADOS
const catalogo = [];

// 2. CAPTURA DE ELEMENTOS DO DOM (Document Object Model).
const form = document.getElementById('cadastro-filme');
const tituloInput = document.getElementById('titulo');
const listaFilmesContainer = document.getElementById('lista-filmes');

// ------------------------------------------------
// FUNÇÃO DE REMOÇÃO
// ------------------------------------------------
function removerFilme(indice, elementoDOM) {
    catalogo.splice(indice, 1);
    elementoDOM.remove();

    // Atualiza a mensagem da lista se estiver vazia
    if (catalogo.length === 0) {
        listaFilmesContainer.innerHTML = '<p>Nenhum filme cadastrado ainda.</p>';
    }

    console.log(`Filme no índice ${indice} removido. Catálogo atualizado:`, catalogo);
}

// -------------------------------------------------------------
// FUNÇÃO DE RENDERIZAÇÃO
// -------------------------------------------------------------
function renderizarFilme(filme, indice) {

    if (catalogo.length === 1) {
        listaFilmesContainer.innerHTML = '';
    }

    const filmeDiv = document.createElement('div');
    filmeDiv.classList.add('filme-item');

    const imagemPoster = document.createElement('img');
    imagemPoster.src = filme.poster && filme.poster !== 'N/A' ? filme.poster : '';
    imagemPoster.alt = `Poster do Filme ${filme.titulo}`;
    imagemPoster.classList.add('filme-poster');

    const infoDiv = document.createElement('div');
    infoDiv.classList.add('filme-info');

    const tituloH3 = document.createElement('h3');
    tituloH3.textContent = filme.titulo;

    const sinopseP = document.createElement('p');
    sinopseP.textContent = filme.sinopse;

    const removerBotao = document.createElement('button');
    removerBotao.textContent = 'Remover';
    removerBotao.classList.add('btn-remover');

    removerBotao.addEventListener('click', () => {
        const indiceAtual = catalogo.findIndex(f => f.titulo === filme.titulo);
        if (indiceAtual > -1) {
            removerFilme(indiceAtual, filmeDiv);
        }
    });

    infoDiv.appendChild(tituloH3);
    infoDiv.appendChild(sinopseP);
    infoDiv.appendChild(removerBotao);

    filmeDiv.appendChild(imagemPoster);
    filmeDiv.appendChild(infoDiv);

    listaFilmesContainer.appendChild(filmeDiv);
}

// FUNÇÃO PRINCIPAL DE ADIÇÃO (Assíncrona para a API)
async function adicionarFilme(evento) {
    evento.preventDefault();

    const titulo = tituloInput.value.trim();
    if (!titulo) return;

    const tituloFormatado = encodeURIComponent(titulo);
    const url = `https://www.omdbapi.com/?apikey=${API_KEY}&t=${tituloFormatado}`;

    try {
        const resposta = await fetch(url);
        const dadosDoFilme = await resposta.json();

        if (dadosDoFilme.Response === "True") {
            const novoFilme = {
                titulo: dadosDoFilme.Title,
                sinopse: dadosDoFilme.Plot,
                poster: dadosDoFilme.Poster,
            };

            catalogo.push(novoFilme);
            renderizarFilme(novoFilme, catalogo.length - 1);
        } else {
            alert(`Filme não encontrado na OMDb: "${titulo}".`);
        }

    } catch (error) {
        alert('Ocorreu um erro ao tentar buscar o filme na API. Verifique sua chave.');
        console.error('Erro de Fetch:', error);
    }

    form.reset();
}

// 6. ESCUTANDO O EVENTO DO FORMULÁRIO
form.addEventListener('submit', adicionarFilme);

console.log("JavaScript Carregado. Pronto para iniciar o catálogo!");
</script>

</body>
</html>

